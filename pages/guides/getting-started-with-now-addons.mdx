import Guide from '~/components/layout/guide'
import { TerminalInput } from '~/components/text/terminal'
import { Image } from '~/components/media'
import Caption from '~/components/text/caption'
import { InlineCode, Code } from '~/components/text/code'
import Card from '~/components/card'
import Note from '~/components/text/note'
import { GenericLink } from '~/components/text/link'

export const meta = {
  title: 'Create Addons for Your Customers with ZEIT Now',
  description:
    'Learn how to create Addons for ZEIT Now to makes the lives of your customers easier.',
  published: '2019-05-03T09:03:14.819Z',
  authors: ['arunoda', 'msweeneydev'],
  url: '/guides/getting-started-with-now-addons',
  editUrl: 'pages/guides/getting-started-with-now-addons.mdx',
  lastEdited: '2019-05-04T12:37:55.000Z'
}

This guide will help you to extend the capabilities of ZEIT using Addons. We allow you to create Addons for three basic use cases, these are:

1. **Standalone** - These Addons live inside [zeit.co](http://zeit.co) and have access to the API with the ability to create a custom UI
2. **OAuth** - These support the standard OAuth2 protocol
3. **Hybrid** - A mix of both Standalone and OAuth, these are useful for mashups or when you need a long lasting token

## When to Use

Before we look at how to create Addons, let's take a look at which type of Addon is suitable in different situations:

- Login with ZEIT: **OAuth**
- Add ZEIT Integration inside your Addon/website: **OAuth**
- Add a database integration(add connection string to a ZEIT project): **Standalone**
- Add error tracking/perf. monitoring(expose the env. var): **Standalone**
- List top contributors inside a ZEIT team: **Standalone**
- Add email support for your domain: **Standalone**
- An Addon for AI powered face detection(Expose some API endpoint): **Standalone**
- BitBucket integration: **Hybrid** (Store the **OAuth** token to work with deployments. Use **Standalone** to select BitBucket repositories to build)
- Create a mashup with users AWS and ZEIT API access: **Hybrid**

## Creating an Addon

Even though we support a variety of use cases, there is only one type of Addon. An Addon can take the desired type based on how it is configured.

To create an Addon, simply visit: [https://zeit.co/dashboard/integrations](/dashboard/integrations) and click the "Create New Addon" button.

When you are creating your Addon, you can enter two URI's:

1. Redirect URI
2. UI Hook URI

These can be updated at a later date also.

We identify the [type of your Addon](#when-to-use) by looking at those URI's:

- **OAuth** - Redirect URI **only**
- **Standalone** - UI Hook URI **only**
- **Hybrid** - **Both** URIs defined

## Writing the Addon

Let's talk about writing the Addon for each of the different use cases outlined above.

### 1. Standalone Addons

With standalone Addons, you can introduce custom user interfaces inside <https://zeit.co>. While rendering that UI, you have access to the token of the user installing the app.

#### **UI Hook**

The UI Hook is a key part of this process. It is like a webhook, but you can provide a user interface as the response. Like a webhook, it works with HTTP POST.

Below is an example of the code you might write for a UI Hook:

```js
function databaseProviderUiHook(token, clientState, action) {
  if (action === 'create-db') {
    const { dbName } = clientState
    // create a db inside your Addon
    // use the token with ZEIT api to add a project level env. var
    // with the connection URL to your DB
    return `
    	<Page>
        <Notice displayFor="5secs">Database created</Notice>
        ${getDBListJSX()}
      </Page>
    `
  }

  return `
    <Page>
      <Container>
        <Input name="dbName" label="Name for your DB" />
        <Button action="create-db">Create DB</Button>
      </Container>
      ${getDBListJSX()}
    </Page>
  `
}
```

<Caption>A UI Hook example for a ZEIT Addon.</Caption>

As shown in the above example, a UI Hook will receive the following:

- `token` - A short lived ZEIT token for the installing users ZEIT account
- `clientState` - The state of the UI in the client side. Keys are names you passed to Form components such as Input, Select, etc.
- `action` - Desired action of the user. This is the action prop you pass to a Button. There are other components which support the action prop such as AutoRefresh, Link, etc.
- `userId` - The user ID of the user accessing your Addon
- `teamId` - The Team ID of the team who installed the Addon
- `projectId` - The project ID of the project Your Addon was viewed inside by the user

These inputs can be used to perform the tasks required by your Addon. In the above case this was listing and creating databases.

After your Addon has completed the required tasks, it should return some JSX to populate the interface.

#### HTTP Based

The UI Hooks are HTTP endpoints. Therefore, you can deploy them anywhere with unlimited possibilities.

Below is a list of what is required to create a HTTP POST based Standalone Addon:

- A HTTP POST body that contains JSON with [inputs](#ui-hook)
- An endpoint with CORS enabled (we talk to it from client side as well)
- A JSX string sent as text with a 200 status code

When creating the Addon, you should put the Addon's URL in the **UI Hook URI** field, this can be updated whenever needed.

#### Component System

To help you create Addons effortlessly and in keeping with ZEIT design, we have created a component system for you to use.

The component system is comprised of React components created with JSX, however, some limitations have been added for safety and use via HTTP.

Below is a list of things to keep in mind when using the component system:

- You should return a JSX string, no NPM modules are supported
- JavaScript is not supported for security reasons
- HTML/CSS/StyleJSX are not supported to keep styles inline with other resources

<Card title="Example Addons" href="https://github.com/zeit/apps">
  Get inspired and learn how best to craft your Addons with these examples.
</Card>

Read more from the page below:

[Component System](https://www.notion.so/22f47f00f9294289adac8cd92e3cf191)

#### Addon Installation

Every Addon has a public URL with the following format:

You should contact us to list your Addon in our marketplace. To do this, send an email so addons@zeit.co with the following information:

- Information
- Information
- Information

Once we have made your Addon available in the marketplace, you will be able to supply your customers with an Addon URL which takes the following format:

<Code>https://front-git-integrations.zeit.sh/app/:slug</Code>

By visiting the URL, users can install the Addon **with a single click**. This makes it easy for your users to install Addons quickly and be productive immediately.

Once the Addon is installed, the UI Hook will be called every time the user views your Addon.

### 2. OAuth Addons

Once you create an Addon with the above process, you will get a **client_id** and a **client_secret.** These are the OAuth2 **client credentials**.

You can then read our [API docs](/docs/api#endpoints/oauth2) in order to understand how to use them. This is very similar to creating an OAuth application with another provider.

The following flow describes the way you typically use an **OAuth Addon**:

- [Create](#creating-an-addon) and deploy your Addon (for dev you can use localhost)
- Use your Addon's URL in the **Redirect URI** field when [creating an Addon](#creating-an-addon)
- Ask your users to visit [https://zeit.co/oauth/authorize?client_id=\<your client id\>](https://zeit.co/oauth/authorize?client_id=<your) to authorize and install the Addon
- The users browser will redirect back to your Addon with a code
- Using that code, you can [exchange a token](https://zeit.co/docs/api#endpoints/oauth2/exchanging-code-for-an-access-token)
- You can use that token to access any [API resource](https://zeit.co/docs/api#endpoints/oauth2/exchanging-code-for-an-access-token) on behalf of the user
- You should save that token in your Addon by assigning it to a user

You can ask your users to visit the [authorization url](https://www.notion.so/zeithq/Guide-Zeit-Apps-c0ff5f96bcd54c488637910bd0bb15d4#fd3932c6125c488e8213485be1ee413d) as many times you need. It can used for "Login With ZEIT" feature.

<Card
  title="OAuth Addon"
  href="https://github.com/zeit/apps/tree/master/oauth-basics"
>
  Understand how to implement an OAuth Addon.
</Card>

### 3. Hybrid Addons

Hybrid Addons are a mix of **both OAuth and Standalone Addons**. These Addons are installed in the same way as a **Standalone Addon**, by visiting the public URL.

The following flow describes the way you typically use a **Hybrid Addon**:

- Once installed, the user is redirected to your Addons **redirectURI**
- User is authorized through ZEIT [OAuth token exchange](https://zeit.co/docs/api#endpoints/oauth2/exchanging-code-for-an-access-token) or a third party
- Once authorized, the user is redirected back to ZEIT
- **callbackUrl** query string parameter added when navigating the user to your **redirectUri**
- Addon rendered using the UI Hook

## Development vs Production

### Local Development

You can develop your Addon locally using your localhost. You can use localhost URLs for both **redirectURI** and **uiHookURI** for the time required.

To provide access to your Addon during local development you can use a tunneling service such as [ngrok](https://ngrok.com) or [localtunnel](https://github.com/localtunnel/localtunnel).

### Cloud Deployment

Since these Addons are just HTTP endpoints, you can deploy to anywhere. But deploying to lambda with ZEIT will be your best choice.

**Two Addons**

Create two different Addons from our integration dashboard for your production and dev Addon. With that, you can work with your dev Addon without breaking the production Addon.

You can create any number of Addon you like.

(Just for now, we do not allow you to delete Addons. It will be added soon)

## Example Addons

## More Resources

For more information on working with [Now for GitLab](/gitlab), please refer to [the Now for GitLab documentation](/docs/v2/integrations/now-for-gitlab).

To configure Now further, please see these additional topics and guides:

<Card title="Deploying Basics" href="/docs/v2/deployments/basics">
  Deploy any of your applications with ZEIT Now.
</Card>

<Card
  title="Aliasing"
  href="/docs/v2/domains-and-aliases/aliasing-a-deployment/"
>
  Learn more about aliasing to your deployments.
</Card>

<Card title="Routes" href="/docs/v2/deployments/routes">
  Learn more about how Now uses routes to define the behavior of how a request
  is handled on the routing side.
</Card>

<Card title="More Guides" href="/guides">
  See more guides that help you move forward with your projects and automatic
  deployments from Now for GitLab.
</Card>

export default ({ children }) => <Guide meta={meta}>{children}</Guide>
