import Doc from '~/components/layout/docs'
import { Image } from '~/components/media'
import { Code } from '~/components/text/code'
import Caption from '~/components/text/caption'
import Example from '~/components/example'

export const meta = {
  title: 'Status Codes',
  description:
    'Status codes are given in different circumstances to give you as much insight as possible into your deployments.',
  editUrl: 'pages/docs/v2/routing/status-codes.mdx',
  lastEdited: '2019-05-03T00:01:28.000Z'
}

In order to give you the best possible insight into what exactly is wrong with your deployment, we implemented several status codes into the [Routing Layer](/docs/v2/routing/overview) of Now.

## Response Types

By default, browsers (and any other client that sets the [`Accept`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept) header to a value containing `text/html`) will receive the status codes as the following HTML template:

<Image
  src={`https://assets.zeit.co/image/upload/v1541618244/front/docs/routing/status-codes/preview.png`}
  width={1364 / 2}
  height={818 / 2}
/>

<Caption>An example of how a status code response could look like</Caption>

Depending on your status code, the title ("404"), description ("The page could not be found") and the code ("FILE_NOT_FOUND") will vary.

However, if your client is sending the `Accept` header with a value that contains `application/json`, it will receive the same error, but formatted as [JSON](https://en.wikipedia.org/wiki/JSON):

```json
{
  "status": "FILE_NOT_FOUND",
  "description": "The page could not be found"
}
```

Assuming that your client is not sending the `Accept` header at all, we will default to sending the description of the status code in the `text/plain` format (plain text):

```
The page could not be found
```

## List of Status Codes

### 303

Type: **Application/Infrastructure** - `DEPLOYMENT_NOT_READY_REDIRECTING`

Deployment not ready, redirecting to inspector.

### 402

Type: **Application/Infrastructure** - `DEPLOYMENT_BLOCKED`

Your subscription was blocked.

### 404 - `FILE_NOT_FOUND`

##### Error Type: **Application**

##### Caused By:

- A missing file or lambda at the requested location
- An incorrect path set to access a resource

##### Steps to Resolve:

Make a note of what path your application is trying to retrieve the resource from.

If unsure, open your developer tools and select the network tab. Then, refresh the page and find the request in the list (it will be Red) with a 404 error code.

After this, find where you link to this path and amend it if incorrect or ensure the resource is there and available for requests.

### 404 - `DEPLOYMENT_NOT_FOUND`

##### Error Type: **Application**

##### Caused By:

- A deployment that used to exist at that location being removed

##### Steps to Resolve:

As the application developer, you can use the `now` command to trigger a new deployment.

You should be aware that hashed URL's are intended to be unique and the error will remain on these.

Visiting the new deployed hash URL or the deployment alias will resolve this issue.

### 413

Type: **Application** - `LAMBDA_PAYLOAD_TOO_LARGE`

The request's body is too large for invoking the <b>Lambda</b>.

### 500 - `INTERNAL_SERVER_ERROR`

##### Error Type: **Application**

<Example>

**Example logs output:**

<Code lang="shell">{`
{ FetchError: invalid json response body at https://twitter-guestbook.now.sh/api/guestbook reason: Unexpected token T in JSON at position 0
    at /var/task/page.js:8760:32
    at <anonymous>
    at process._tickDomainCallback (internal/process/next_tick.js:228:7)
  message: 'invalid json response body at https://twitter-guestbook.now.sh/api/guestbook reason: Unexpected token T in JSON at position 0',
  type: 'invalid-json' }
  `}</Code>
</Example>

##### Caused By:

- Application code errors that usually form part of the initial page load

##### Steps to Resolve:

To resolve this issue you should check your deployment logs. As mentioned above the most likely cause of this error is a mistake in the application code.

You should check your logs immediately after receiving the error as this will make it easier to find, it is nearly always the last log output.

### 500

Type: **Application** - `INTERNAL_LAMBDA_NOT_FOUND`

We were not able to locate the <b>Lambda</b> responsible for the path you tried to access.

### 500

Type: **Application** - `INTERNAL_INVALID_LAMBDA_REGION`

No <b>Lambda</b> was found in the region identifier attached to the deployment.

### 500

Type: **Application** - `INTERNAL_LAMBDA_INVOCATION_FAILED`

The <b>Routing layer</b> was not able to invoke the <b>Lambda</b>.

### 502

Type: **Application** - `NO_STATUS_CODE_FROM_LAMBDA`

The <b>Lambda</b> responsible for the path you tried to access did not reply with a status code.

### 502

Type: **Application** - `BODY_NOT_A_STRING_FROM_LAMBDA`

The <b>Lambda</b> responsible for the path you tried to access replied with a non-string body.

### 504

Type: **Application/Infrastructure** - `LAMBDA_INVOCATION_TIMEOUT`

The <b>Lambda</b> responsible for the path you tried to access did not reply in time.

export default ({ children }) => <Doc meta={meta}>{children}</Doc>
